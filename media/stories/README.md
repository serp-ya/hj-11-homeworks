NetoStories
===

Новый продуктолог Нетологии решил внедрить в личный кабинет студентов функционал историй: возможность записать и поделиться коротким видео. Студенты смогут публиковать свои видео, и смотреть видео одногрупников.

![Истории студентов](./res/preview.png)

## Функционал

Большая часть функционала историй уже реализована. Вам осталось реализовать только самую ключевую функцию: запись короткого видео с помощью веб-камеры.

Для этого вам необходимо реализовать функцию `record`. Сейчас там реализована заглушка этой функции.

Функция должна принимать следующие аргументы:
1. `app` — приложение, который позволяет управлять интерфейсом приложения, _объект_.
2. `config` — конфигурация медиа устройства необходимого для записи видео, _объект_.
3. `limit` — длина видео в милисекундах, _число_.

Функция должна вернуть промис (`Promise`) который разрешится объектом со следующими свойствами:
* `video` — записанное видео, `Blob`;
* `frame` — кадр из видео, `Blob`.

Так же, во время записи необходимо управлять состоянием интерфейса через объект приложения `app`. Свойство `mode` этого объекта позволяет перевести интерфейс в то или иное состояние. Доступны следующие состояния:
* `preparing` — приложение готовится к началу записи,
* `recording` — идет запись видео,
* `sending` — видео записано, идет отправка видео на сервер,
* `sended` — видео успешно отправлено.

Сразу при вызове функции `record` необходимо установить состояние `preparing`:
```javascript
app.mode = 'preparing';
```

После того как доступ к камере получен и вы готовы начать запись переключите режим в `recording`. На этом этапе так же важно направить видео-поток с камеры в окно предварительного просмотра, чтобы пользователь видел что записывает. Для этого у объекта `app` есть свойство `preview` — это ссылка на элемент `video`. Направить поток `stream` можно например так:
```javascript
app.preview.srcObject = stream;
```

При этом непонсредственно запись рекомендуем начинать через одну секунду с момента включения камеры.

Запись необходимо остановить скриптом спустя количество милисекунд заданное в `app.limit`. В этот момент состояние приложение нужно переключить в `sending`.

Отключите предварительный просмотр с камеры:
```javascript
app.preview.srcObject = null;
```

После остановки выключите камеру. Это можно сделать с помощью следующей команды:
```javascript
stream.getTracks().forEach(track => track.stop())
```

Создайте кадр из видео с помощью функции `createThumbnail` (описана далее), и полученные `Blob` объекты видео и изображения разрешите в промис как описано выше.

В случае любых ошибок переведите промис в статус `rejected` с объектом ошибки. Самостоятельно обрабатывать ошибки не требуется.

## Дополнительные функции

`createThumbnail` — позволяет получить кадр из видео. Принимает видео в формате `Blob`, возвращает промис (`Promise`), который разрешится изображением в формате `Blob`.

Так же добавлен полифил для работы `navigator.mediaDevices.getUserMedia` в браузерах, которые имеют не стандартную реализацию.

## Реализация

При реализации нельзя изменять HTML-код и CSS-стили.

### Локально с использованием git

Реализацию необходимо поместить в файл `./js/recorder.js`. Файл уже подключен к документы, поэтому другие файлы изменять не требуется.

### В песочнице CodePen

Реализуйте функционал вкладке JS. Перед началом работы сделайте форк этого пена:

https://codepen.io/dfitiskin/pen/yPKyGx
